script:
  - scene: entry_guard
  - scene: first_intro
  - scene: revisit_intro
  - scene: item_gate
  - scene: item_get
  - scene: interrogation_start
  - scene: interrogation_correct
  - scene: interrogation_wrong
  - scene: motive_probe
  - scene: motive_correct
  - scene: motive_wrong
  - scene: revisit_question
  - scene: outro

scenes:
  entry_guard:
    actions:
      - branch:
          cases:
            - when:
                var: visited_reiko
                op: eq
                value: true
              goto: revisit_intro
          default: first_intro

  first_intro:
    actions:
      - bg: tea_room
      - music: reasoning
      - set:
          visited_reiko: true
      - add:
          exploration_count: 1
      - char:
          id: 레이코
          position: left
          emotion: nervous
      - char:
          id: 코난
          position: center
          emotion: serious
      - say:
          char: 레이코.nervous
          with:
            - 코난.serious
          text: "<speed=30>전 88도 유지 로그만 봤어요.</speed> <speed=24>그 이상은 정말 몰라요...</speed>"
      - say:
          char: 코난.serious
          text: "<speed=34>좋아.</speed> <speed=30>지금부터는 시간과 장치로만 묻는다.</speed>"
      - goto: item_gate

  revisit_intro:
    actions:
      - bg: tea_room
      - char:
          id: 레이코
          position: left
          emotion: nervous
      - char:
          id: 코난
          position: center
          emotion: think
      - say:
          char: 레이코.nervous
          with:
            - 코난.think
          text: "<speed=28>...다시 물어보세요.</speed> <speed=24>이번엔 숨기지 않을게요.</speed>"
      - goto: revisit_question

  item_gate:
    actions:
      - branch:
          cases:
            - when:
                var: reiko_temp_log
                op: eq
                value: true
              goto: interrogation_start
          default: item_get

  item_get:
    actions:
      - get: reiko_temp_log
      - sticker:
          id: item_popup_reiko_temp
          image: item_reiko_statement_note
          x: 50
          y: 30
          width: 22
          enter:
            effect: popIn
          inputLockMs: 500
      - wait: 2600
      - say:
          char: 코난.think
          text: "<speed=34>레이코 온도 로그를 확보했다.</speed> <speed=56>타이머 재설정 시각이 찍혀 있다.</speed>"
      - clearSticker:
          id: item_popup_reiko_temp
          leave:
            effect: fadeOut
      - goto: interrogation_start

  interrogation_start:
    actions:
      - choice:
          key: reiko_main_probe
          prompt: "레이코 진술에서 먼저 고정할 지점은?"
          options:
            - text: "88도 로그와 타이머 재설정 21:27 기록"
              set:
                clue_reiko_temp: true
              add:
                deduction_score: 2
                final_confidence: 1
              goto: interrogation_correct
            - text: "켄지와 다퉜으니 감정적으로 범행했을 것"
              add:
                mistake_count: 1
                trust: -1
              goto: interrogation_wrong
            - text: "2R이 R 이니셜이니 바로 레이코 확정"
              add:
                mistake_count: 1
                trust: -1
              goto: interrogation_wrong

  interrogation_correct:
    actions:
      - say:
          char: 코난.serious
          text: "<speed=52>좋아.</speed> <speed=34>21:27 타이머 재설정은 알리바이랑 충돌한다.</speed>"
      - goto: motive_probe

  interrogation_wrong:
    actions:
      - say:
          char: 코난.think
          text: "<speed=26>감정 추측만으론 못 이겨.</speed> <speed=60>시각과 장치를 먼저 잠가.</speed>"
      - goto: motive_probe

  motive_probe:
    actions:
      - choice:
          key: reiko_motive_probe
          prompt: "레이코 동기 라인에서 입증 가능한 문장은?"
          options:
            - text: "하루오가 연구노트 위조를 폭로하려 했다"
              set:
                clue_motive_contract: true
              add:
                deduction_score: 2
                trust: 1
              goto: motive_correct
            - text: "켄지가 돈을 빼돌려 레이코가 복수했다"
              add:
                mistake_count: 1
              goto: motive_wrong
            - text: "아무 동기 없이 우발적으로 독을 넣었다"
              add:
                mistake_count: 1
                final_confidence: -1
              goto: motive_wrong

  motive_correct:
    actions:
      - sound: notebook_flip
      - say:
          char: 레이코.nervous
          with:
            - 코난.serious
          text: "<speed=24>...하루오 씨가 내 장부를 경찰에 넘기겠다고 했어요.</speed>"
      - say:
          char: 코난.serious
          text: "<speed=40>좋아, 동기선 확보.</speed> <speed=34>하지만 아직 확정은 안 한다.</speed>"
      - goto: outro

  motive_wrong:
    actions:
      - say:
          char: 코난.think
          text: "<speed=24>(동기선이 흐리다...)</speed> <speed=58>다른 단서로 다시 메운다.</speed>"
      - goto: outro

  revisit_question:
    actions:
      - choice:
          key: reiko_revisit_probe
          prompt: "레이코에게 무엇을 다시 묻겠어?"
          options:
            - text: "21:27 타이머 재설정 시각을 재확인한다"
              set:
                clue_reiko_temp: true
              add:
                deduction_score: 1
              goto: outro
            - text: "하루오와 연구노트 갈등을 재확인한다"
              set:
                clue_motive_contract: true
              add:
                trust: 1
              goto: outro
            - text: "이번엔 여기까지"
              goto: outro

  outro:
    actions:
      - say:
          char: 코난
          text: "<speed=50>레이코 라인 종료.</speed> <speed=34>탐문 라운지로 복귀한다.</speed>"
      - goto: /routes/hub/1.yaml
