script:
  - scene: lounge_intro
  - scene: all_done_check
  - scene: all_done_bonus
  - scene: route_select
  - scene: early_exit_confirm
  - scene: early_exit_penalty_branch
  - scene: early_exit_penalty_3
  - scene: early_exit_penalty_2
  - scene: early_exit_penalty_1
  - scene: move_to_conclusion

scenes:
  lounge_intro:
    actions:
      - bg: ryokan_hall
      - music: reasoning
      - char:
          id: 코난
          position: center
          emotion: think
      - say:
          char: 코난.think
          text: "단서 정리실로 돌아왔어. 아직 안 만난 사람부터 바로 들어가자."
      - goto: all_done_check

  all_done_check:
    actions:
      - branch:
          cases:
            - when:
                var: investigation_count
                op: gte
                value: 4
              goto: all_done_bonus
          default: route_select

  all_done_bonus:
    actions:
      - set:
          early_exit_taken: false
      - add:
          deduction_score: 1
          final_confidence: 1
          trust: 1
      - say:
          char: 코난.serious
          text: "좋아, 네 명 다 확인했어. 이제 모아 놓고 한 번에 끝낸다."
      - goto: move_to_conclusion

  route_select:
    actions:
      - say:
          char: 코난.think
          text: "다음 타깃을 고르자. 누구부터 흔들어 볼까?"
      - choice:
          key: route_select
          prompt: "다음으로 누구를 먼저 상대할까?"
          options:
            - text: "신이치랑 얘기한다"
              goto: /routes/shinichi/1.yaml
            - text: "레이코를 먼저 본다"
              goto: /routes/reiko/1.yaml
            - text: "켄지를 다시 붙잡는다"
              goto: /routes/kenji/1.yaml
            - text: "하루오에게 확인한다"
              goto: /routes/haruo/1.yaml
            - text: "지금 정리 회의로 간다"
              goto: early_exit_confirm

  early_exit_confirm:
    actions:
      - say:
          char: 코난.think
          text: "여기서 바로 결론으로 가면 반박에 약해질 수 있어. 그래도 갈까?"
      - choice:
          key: early_exit_confirm
          prompt: "지금 바로 정리 회의로 넘어갈까?"
          options:
            - text: "아직 더 확인한다"
              goto: route_select
            - text: "여기서 바로 간다"
              set:
                early_exit_taken: true
              goto: early_exit_penalty_branch

  early_exit_penalty_branch:
    actions:
      - branch:
          cases:
            - when:
                var: investigation_count
                op: gte
                value: 3
              goto: early_exit_penalty_3
            - when:
                var: investigation_count
                op: gte
                value: 2
              goto: early_exit_penalty_2
          default: early_exit_penalty_1

  early_exit_penalty_3:
    actions:
      - add:
          final_confidence: -1
      - say:
          char: 코난.think
          text: "한 명을 비워 둔 채 간다. 설득력은 한 칸 깎여."
      - goto: move_to_conclusion

  early_exit_penalty_2:
    actions:
      - add:
          deduction_score: -1
          final_confidence: -2
      - say:
          char: 코난.think
          text: "절반만 보고 가면, 결론은 흔들릴 수밖에 없어."
      - goto: move_to_conclusion

  early_exit_penalty_1:
    actions:
      - add:
          deduction_score: -2
          final_confidence: -3
          trust: -1
          mistake_count: 1
      - say:
          char: 코난.think
          text: "이건 너무 성급했어. 지금 상태론 반박 한 번이면 무너진다."
      - goto: move_to_conclusion

  move_to_conclusion:
    actions:
      - say:
          char: 코난
          text: "좋아, 집합 추리로 이동한다."
      - goto: /conclusion/1.yaml
