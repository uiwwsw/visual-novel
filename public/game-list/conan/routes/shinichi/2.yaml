meta:
  title: "명탐정 코난 외전: 다실의 비밀"
  author: "uiwwsw"
  version: "4.0"

settings:
  textSpeed: 38
  autoSave: true
  clickToInstant: true

assets:
  backgrounds:
    mountain_rain: ../../assets/bg/mountain_rain.png
    tea_room: ../../assets/bg/tea_room.png

  characters:
    코난:
      base: ../../assets/char/conan/base.png
      emotions:
        think: ../../assets/char/conan/think.png
        serious: ../../assets/char/conan/serious.png

    신이치:
      base: ../../assets/char/shinichi/base.png
      emotions:
        cold: ../../assets/char/shinichi/cold.png

    레이코:
      base: ../../assets/char/reiko/base.png
      emotions:
        nervous: ../../assets/char/reiko/nervous.png

    코고로:
      base: ../../assets/char/kogoro/base.png
      emotions:
        angry: ../../assets/char/kogoro/angry.png

  music:
    mystery: ../../assets/music/mystery.wav
    tension: ../../assets/music/tension.wav

state:
  defaults:
    trust: 0
    truth_point: 0
    mistake_count: 0
    comeback_chance: 1
    route_origin: ""
    suspect: ""
    culprit_answer: ""

script:
  - scene: pressure_start
  - scene: suspect_cross_gate
  - scene: wrong_push
  - scene: salvage_gate
  - scene: route_outro

scenes:
  pressure_start:
    actions:
      - bg: mountain_rain
      - music: tension
      - char:
          id: 코난
          position: center
          emotion: serious
      - char:
          id: 코고로
          position: left
          emotion: angry
      - say:
          text: "신이치 루트 2 - 진술 균열"
      - say:
          char: 코난.serious
          text: "여기서 방향을 잘못 틀면, 초반 정답 루트였어도 배드엔딩으로 미끄러진다."
      - goto: suspect_cross_gate

  suspect_cross_gate:
    actions:
      - bg: tea_room
      - char:
          id: 신이치
          position: right
          emotion: cold
      - choice:
          key: shinichi_route2_cross
          prompt: "어느 검증을 먼저 걸까?"
          options:
            - text: "신이치 외투의 젖은 흔적과 찻잎 성분을 대조한다"
              set:
                suspect: "신이치"
              add:
                truth_point: 1
                trust: 1
              goto: salvage_gate
            - text: "레이코 단독 동기만으로 종결하려 한다"
              set:
                suspect: "레이코"
              add:
                mistake_count: 1
                trust: -1
              goto: wrong_push

  wrong_push:
    actions:
      - effect: shake
      - char:
          id: 레이코
          position: left
          emotion: nervous
      - say:
          text: "증언이 꼬였고, 모두가 다시 반발하기 시작했다."
      - branch:
          cases:
            - when:
                var: mistake_count
                op: gte
                value: 3
              goto: route_outro
          default: salvage_gate

  salvage_gate:
    actions:
      - char:
          id: 코난
          position: center
          emotion: think
      - choice:
          key: shinichi_route2_salvage
          prompt: "최종 보고서에 무엇을 핵심 근거로 적을까?"
          options:
            - text: "문틈 줄 트릭과 외투 찻잎을 함께 기록한다"
              set:
                suspect: "신이치"
              add:
                truth_point: 1
                trust: 1
              goto: route_outro
            - text: "레이코의 불안한 표정만 범행 근거로 고수한다"
              set:
                suspect: "레이코"
              add:
                mistake_count: 1
                trust: -1
              goto: route_outro

  route_outro:
    actions:
      - say:
          text: "모든 진술이 결론 회의실로 모이기 시작했다."
      - goto: ./conclusion/1.yaml
