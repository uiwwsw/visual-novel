script:
  - scene: entry_guard
  - scene: revisit_notice
  - scene: intro
  - scene: first_probe
  - scene: retry_notice
  - scene: second_probe
  - scene: motive_branch
  - scene: motive_open_line
  - scene: motive_half_line
  - scene: outro

scenes:
  entry_guard:
    actions:
      - branch:
          cases:
            - when:
                var: visited_reiko
                op: eq
                value: true
              goto: revisit_notice
          default: intro

  revisit_notice:
    actions:
      - bg: ryokan_hall
      - char:
          id: 레이코
          position: left
          emotion: nervous
      - char:
          id: 코난
          position: center
          emotion: think
      - say:
          char: 레이코.nervous
          with:
            - 코난.think
          text: "같은 질문이면 더 떨릴 것 같아요... 다른 단서를 먼저 보시죠."
      - goto: /routes/hub/1.yaml

  intro:
    actions:
      - bg: tea_room
      - music: mystery
      - set:
          visited_reiko: true
      - add:
          investigation_count: 1
      - char:
          id: 레이코
          position: left
          emotion: nervous
      - char:
          id: 코난
          position: center
          emotion: think
      - say:
          char: 레이코.nervous
          with:
            - 코난.think
          text: "88도에서 향이 바뀌는 순간이 있어요. 오늘도 그 순간이 짧게 어긋났어요."
      - say:
          char: 코난.think
          text: "감각과 수치를 함께 맞춰보자. 흔들림을 줄일 수 있어."

  first_probe:
    actions:
      - choice:
          key: reiko_first_probe
          prompt: "레이코 발언에서 먼저 검증할 축은?"
          options:
            - text: "88도 기록과 잔 가장자리 반응 시간을 대조한다"
              set:
                clue_rim_reagent: true
              add:
                deduction_score: 2
              goto: motive_branch
            - text: "떨리는 말투를 바로 범행 신호로 본다"
              add:
                mistake_count: 1
                trust: -1
              goto: retry_notice
            - text: "켄지와의 말다툼만 근거로 묶는다"
              add:
                mistake_count: 1
              goto: retry_notice

  retry_notice:
    actions:
      - say:
          char: 코난.think
          text: "한 번만 더. 감정이 아니라 측정 가능한 값으로 고르자."
      - goto: second_probe

  second_probe:
    actions:
      - choice:
          key: reiko_second_probe
          prompt: "재선택: 어떤 항목이 실증 가능한가?"
          options:
            - text: "88도 기록과 잔 가장자리 반응 시간을 대조한다"
              set:
                clue_rim_reagent: true
              add:
                deduction_score: 1
              goto: motive_branch
            - text: "말투 흔들림만으로 결론낸다"
              add:
                mistake_count: 1
                trust: -1
              goto: motive_half_line
            - text: "분위기만 근거로 확정한다"
              add:
                mistake_count: 1
              goto: motive_half_line

  motive_branch:
    actions:
      - branch:
          cases:
            - when:
                var: clue_rim_reagent
                op: eq
                value: true
              goto: motive_open_line
          default: motive_half_line

  motive_open_line:
    actions:
      - sound: notebook_flip
      - say:
          char: 코난.serious
          text: "계약서 수정 시간과 연구노트 원본이 맞물렸다. 동기가 드러났어."
      - set:
          reiko_motive_open: true
      - add:
          deduction_score: 2
          final_confidence: 1
          trust: 1
      - goto: outro

  motive_half_line:
    actions:
      - say:
          char: 코난.think
          text: "레이코 축은 아직 반쯤만 열렸어. 결론에서 보조 근거로만 써야 해."
      - add:
          mistake_count: 1
      - goto: outro

  outro:
    actions:
      - say:
          char: 코난
          text: "레이코 대면 종료. 조사 라운지로 복귀한다."
      - goto: /routes/hub/1.yaml
