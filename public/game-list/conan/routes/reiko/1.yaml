script:
  - scene: entry_guard
  - scene: revisit_notice
  - scene: intro
  - scene: first_probe
  - scene: first_claim_correct
  - scene: first_claim_wrong
  - scene: retry_notice
  - scene: second_probe
  - scene: second_claim_correct
  - scene: second_claim_wrong
  - scene: motive_branch
  - scene: motive_open_line
  - scene: motive_half_line
  - scene: outro

scenes:
  entry_guard:
    actions:
      - branch:
          cases:
            - when:
                var: visited_reiko
                op: eq
                value: true
              goto: revisit_notice
          default: intro

  revisit_notice:
    actions:
      - bg: ryokan_hall
      - char:
          id: 레이코
          position: left
          emotion: nervous
      - char:
          id: 코난
          position: center
          emotion: think
      - say:
          char: 레이코.nervous
          with:
            - 코난.think
          text: "같은 질문을 반복하면 더 긴장돼요... 다른 단서부터 확인해 주세요."
      - goto: /routes/hub/1.yaml

  intro:
    actions:
      - bg: tea_room
      - music: reasoning
      - set:
          visited_reiko: true
      - add:
          investigation_count: 1
      - char:
          id: 레이코
          position: left
          emotion: nervous
      - char:
          id: 코난
          position: center
          emotion: think
      - say:
          char: 레이코.nervous
          with:
            - 코난.think
          text: "88도 근처에서 향이 확 바뀌어요. 그런데 오늘은 그 타이밍이 이상하게 어긋났어요."
      - say:
          char: 코난.think
          text: "좋아, 감각은 참고만 한다. 지금부터는 증명 가능한 사실만 남긴다."

  first_probe:
    actions:
      - say:
          char: 코난.serious
          with:
            - 레이코.nervous
          text: "질문은 하나야. 네 말 중 지금 바로 증명 가능한 걸 골라."
      - choice:
          key: reiko_first_probe
          prompt: "레이코 말부터 뭘 먼저 확인할까?"
          options:
            - text: "88도 기록과 잔 가장자리 반응 시간을 맞춰 본다"
              set:
                clue_rim_reagent: true
              add:
                deduction_score: 2
              goto: first_claim_correct
            - text: "떨리는 목소리부터 범행 신호로 본다"
              add:
                mistake_count: 1
                trust: -1
              goto: first_claim_wrong
            - text: "켄지와 다툰 사실만으로 묶는다"
              add:
                mistake_count: 1
              goto: first_claim_wrong

  first_claim_correct:
    actions:
      - say:
          char: 코난.serious
          with:
            - 레이코.nervous
          text: "좋아, 그건 수치로 고정할 수 있다. 이걸 주력 증거로 밀어붙일까?"
      - say:
          char: 레이코.nervous
          with:
            - 코난.serious
          text: "...네, 기록표와 같이 보면 반박하기 어려울 거예요."
      - choice:
          key: reiko_first_commit
          prompt: "1차 주장을 확정할까?"
          options:
            - text: "응, 이걸로 간다"
              goto: motive_branch
            - text: "아직 불안하다. 한 번 더 묻는다"
              goto: retry_notice

  first_claim_wrong:
    actions:
      - say:
          char: 코난.think
          with:
            - 레이코.nervous
          text: "지금 고른 건 분위기일 뿐이야. 논리전으로 가면 바로 깨져."
      - say:
          char: 레이코.nervous
          with:
            - 코난.think
          text: "맞아요... 그쪽은 느낌일 뿐이에요."
      - choice:
          key: reiko_first_rebuttal
          prompt: "이 판단을 어떻게 할까?"
          options:
            - text: "틀렸다. 다시 질문한다"
              goto: retry_notice
            - text: "아냐, 이걸로도 밀어본다"
              add:
                mistake_count: 1
                trust: -1
              goto: retry_notice

  retry_notice:
    actions:
      - say:
          char: 코난.think
          text: "(좋아, 재심문이다. 감정은 빼고 측정값만 붙잡아.)"
      - say:
          char: 레이코.nervous
          with:
            - 코난.think
          text: "...네, 수치로 답할게요."
      - goto: second_probe

  second_probe:
    actions:
      - choice:
          key: reiko_second_probe
          prompt: "재선택: 지금 증명할 수 있는 건?"
          options:
            - text: "88도 기록과 잔 가장자리 반응 시간을 맞춰 본다"
              set:
                clue_rim_reagent: true
              add:
                deduction_score: 1
              goto: second_claim_correct
            - text: "말투 흔들림만으로 결론 낸다"
              add:
                mistake_count: 1
                trust: -1
              goto: second_claim_wrong
            - text: "분위기만 보고 확정한다"
              add:
                mistake_count: 1
              goto: second_claim_wrong

  second_claim_correct:
    actions:
      - say:
          text: "챙-! 온도 기록과 반응 시간이 정확히 포개진다."
      - say:
          char: 코난.serious
          with:
            - 레이코.nervous
          text: "좋아, 이번 선택은 맞다. 최종 채택할까?"
      - choice:
          key: reiko_second_commit
          prompt: "최종으로 이 주장을 채택할까?"
          options:
            - text: "채택한다"
              goto: motive_branch
            - text: "보류한다"
              add:
                final_confidence: -1
              goto: motive_half_line

  second_claim_wrong:
    actions:
      - say:
          char: 코난.think
          with:
            - 레이코.nervous
          text: "아직도 감정선이야. 이대로는 동기 라인이 열리지 않아."
      - choice:
          key: reiko_second_rebuttal
          prompt: "지금 선택은?"
          options:
            - text: "접고 돌아간다"
              goto: motive_half_line
            - text: "끝까지 우긴다"
              add:
                trust: -1
              goto: motive_half_line

  motive_branch:
    actions:
      - branch:
          cases:
            - when:
                var: clue_rim_reagent
                op: eq
                value: true
              goto: motive_open_line
          default: motive_half_line

  motive_open_line:
    actions:
      - sound: notebook_flip
      - say:
          char: 코난.serious
          text: "계약서 수정 시각이 연구노트 원본과 정확히 맞물린다. 동기가 열렸어."
      - say:
          char: 레이코.nervous
          with:
            - 코난.serious
          text: "...그 기록까지 이어서 보신 거군요."
      - set:
          reiko_motive_open: true
      - add:
          deduction_score: 2
          final_confidence: 1
          trust: 1
      - goto: outro

  motive_half_line:
    actions:
      - say:
          char: 코난.think
          text: "(레이코 라인은 아직 덜 풀렸어. 결론에선 보조 근거로만 쓴다.)"
      - add:
          mistake_count: 1
      - goto: outro

  outro:
    actions:
      - say:
          char: 코난
          text: "레이코 대면 끝. 라운지로 복귀한다."
      - goto: /routes/hub/1.yaml
