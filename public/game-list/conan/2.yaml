meta:
  title: "명탐정 코난 외전: 다실의 비밀"
  author: "uiwwsw"
  version: "3.0"

settings:
  textSpeed: 38
  autoSave: true
  clickToInstant: true

assets:
  backgrounds:
    mountain_rain: assets/bg/mountain_rain.png
    ryokan_hall: assets/bg/ryokan_hall.png
    tea_room: assets/bg/tea_room.png
    police_tape: assets/bg/police_tape.svg

  characters:
    코난:
      base: assets/char/conan/base.png
      emotions:
        think: assets/char/conan/think.png
        serious: assets/char/conan/serious.png

    란:
      base: assets/char/ran/base.png
      emotions:
        surprised: assets/char/ran/surprised.png
        worried: assets/char/ran/worried.png

    코고로:
      base: assets/char/kogoro/base.png
      emotions:
        proud: assets/char/kogoro/proud.png
        angry: assets/char/kogoro/angry.png

    켄지:
      base: assets/char/kenji/base.png
      emotions:
        angry: assets/char/kenji/angry.png

    레이코:
      base: assets/char/reiko/base.png
      emotions:
        nervous: assets/char/reiko/nervous.png

    신이치:
      base: assets/char/shinichi/base.png
      emotions:
        cold: assets/char/shinichi/cold.png

    하루오:
      base: assets/char/haruo/base.png
      emotions:
        scared: assets/char/haruo/scared.png

  music:
    rain: assets/music/rain.wav
    tension: assets/music/tension.wav
    mystery: assets/music/mystery.wav

  sfx:
    thunder: assets/sfx/thunder.wav
    scream: assets/sfx/scream.wav
    door: assets/sfx/door.wav

state:
  defaults:
    trust: 0
    found_key: false
    suspect: ""
    culprit_answer: ""
    alliance: ""
    timeline_answer: ""
    clue_word: ""

script:
  - scene: corridor_briefing
  - scene: witness_round
  - scene: inquiry_shinichi
  - scene: inquiry_reiko
  - scene: clock_gate
  - scene: false_timeline
  - scene: hidden_mismatch
  - scene: pressure_shinichi
  - scene: pressure_group
  - scene: chapter2_outro

scenes:
  corridor_briefing:
    actions:
      - bg: ryokan_hall
      - sticker:
          id: tape
          image: police_tape
          x: 0
          y: 30
          width: 120
          anchorX: left
          anchorY: top
          zIndex: 1
          enter:
            effect: fadeIn
            duration: 280
            easing: ease-out
      - music: mystery
      - say:
          text: "제2장 - 끊긴 찻잔의 시간"
      - char:
          id: 코고로
          position: right
          emotion: proud
      - char:
          id: 란
          position: left
          emotion: worried
      - char:
          id: 코난
          position: center
          emotion: think
      - say:
          char: 코고로.proud
          text: "좋아, 지금부터 알리바이를 분 단위로 정리한다!"
      - say:
          char: 코난
          text: "누가 먼저 무너지느냐가 핵심이야."
      - goto: witness_round

  witness_round:
    actions:
      - bg: tea_room
      - clearSticker:
          id: tape
          leave:
            effect: fadeOut
            duration: 220
      - music: tension
      - char:
          id: 신이치
          position: right
          emotion: cold
      - char:
          id: 레이코
          position: left
          emotion: nervous
      - char:
          id: 하루오
          position: center
          emotion: scared
      - say:
          text: "세 사람의 증언은 분 단위에서 계속 엇갈렸다."
      - choice:
          key: chapter2_probe
          prompt: "누구를 먼저 집중 추궁할까?"
          options:
            - text: "신이치부터 추궁"
              set:
                suspect: "신이치"
              add:
                trust: 1
              goto: inquiry_shinichi
            - text: "레이코부터 추궁"
              set:
                suspect: "레이코"
              add:
                trust: 0
              goto: inquiry_reiko

  inquiry_shinichi:
    actions:
      - say:
          char: 코난.serious
          with:
            - 신이치.cold
          text: "신이치 씨, 9시 20분부터 35분까지 어디 있었죠?"
      - say:
          char: 신이치.cold
          text: "복도 흡연실 앞. 비 때문에 창문만 보고 있었어."
      - say:
          char: 코난
          text: "좋아요. 그 진술, 곧 다시 확인하죠."
      - goto: clock_gate

  inquiry_reiko:
    actions:
      - say:
          char: 코난.serious
          with:
            - 레이코.nervous
          text: "레이코 씨, 계산실에 있었다는 근거를 말해줘요."
      - say:
          char: 레이코.nervous
          text: "결제 전표 정리 중이었어요. 시계는 9시 반 직전이었고요."
      - say:
          char: 코난
          text: "좋아요. 그 시간부터 맞춰봅시다."
      - goto: clock_gate

  clock_gate:
    actions:
      - bg: ryokan_hall
      - music: mystery
      - char:
          id: 코난
          position: center
          emotion: serious
      - input:
          prompt: "피해자의 비명이 들린 시각을 24시간 형식으로 입력해줘."
          correct: "21:30"
          errors:
            - "24시간 표기로 입력해봐."
            - "힌트: 복도 시계 바늘이 6을 가리켰어."
            - "정답은 21:30이야."
          saveAs: timeline_answer
          routes:
            - equals: "21:30"
              add:
                trust: 1
              goto: hidden_mismatch
            - equals: "21:20"
              add:
                trust: -1
              goto: false_timeline

  false_timeline:
    actions:
      - effect: tilt
      - say:
          char: 코난
          text: "그 시각이면 문이 파손된 타이밍과 안 맞아. 다시 계산해보자."
      - goto: clock_gate

  hidden_mismatch:
    actions:
      - bg: tea_room
      - music: tension
      - branch:
          cases:
            - when:
                all:
                  - var: trust
                    op: gte
                    value: 2
                  - var: alliance
                    op: eq
                    value: "레이코"
              goto: pressure_shinichi
          default: pressure_group

  pressure_shinichi:
    actions:
      - char:
          id: 코난
          position: center
          emotion: serious
      - char:
          id: 신이치
          position: right
          emotion: cold
      - say:
          char: 코난.serious
          text: "신이치 씨 외투 소매, 빗속에 있었다면 더 젖어야 해요."
      - say:
          char: 신이치
          text: "내가 어디 있었든, 살인과는 상관없어."
      - add:
          trust: 1
      - goto: chapter2_outro

  pressure_group:
    actions:
      - char:
          id: 코난
          position: center
          emotion: think
      - char:
          id: 레이코
          position: left
          emotion: nervous
      - char:
          id: 하루오
          position: right
          emotion: scared
      - say:
          text: "누군가 시각을 어긋나게 기억하도록 유도한 흔적이 남아 있었다."
      - set:
          suspect: "신이치"
      - goto: chapter2_outro

  chapter2_outro:
    actions:
      - sound: thunder
      - effect: darken
      - say:
          text: "첫 번째 거짓 알리바이가 무너졌다."
      - goto: ./3.yaml
