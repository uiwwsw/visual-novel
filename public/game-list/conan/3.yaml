meta:
  title: "명탐정 코난 외전: 다실의 비밀"
  author: "uiwwsw"
  version: "3.0"

settings:
  textSpeed: 38
  autoSave: true
  clickToInstant: true

assets:
  backgrounds:
    mountain_rain: assets/bg/mountain_rain.png
    ryokan_hall: assets/bg/ryokan_hall.png
    tea_room: assets/bg/tea_room.png
    police_tape: assets/bg/police_tape.svg

  characters:
    코난:
      base: assets/char/conan/base.png
      emotions:
        think: assets/char/conan/think.png
        serious: assets/char/conan/serious.png

    란:
      base: assets/char/ran/base.png
      emotions:
        surprised: assets/char/ran/surprised.png
        worried: assets/char/ran/worried.png

    코고로:
      base: assets/char/kogoro/base.png
      emotions:
        proud: assets/char/kogoro/proud.png
        angry: assets/char/kogoro/angry.png

    켄지:
      base: assets/char/kenji/base.png
      emotions:
        angry: assets/char/kenji/angry.png

    레이코:
      base: assets/char/reiko/base.png
      emotions:
        nervous: assets/char/reiko/nervous.png

    신이치:
      base: assets/char/shinichi/base.png
      emotions:
        cold: assets/char/shinichi/cold.png

    하루오:
      base: assets/char/haruo/base.png
      emotions:
        scared: assets/char/haruo/scared.png

  music:
    rain: assets/music/rain.wav
    tension: assets/music/tension.wav
    mystery: assets/music/mystery.wav

  sfx:
    thunder: assets/sfx/thunder.wav
    scream: assets/sfx/scream.wav
    door: assets/sfx/door.wav

state:
  defaults:
    trust: 0
    found_key: false
    suspect: ""
    culprit_answer: ""
    alliance: ""
    timeline_answer: ""
    clue_word: ""

script:
  - scene: evidence_table
  - scene: clue_gate
  - scene: wrong_clue
  - scene: reenactment
  - scene: fracture
  - scene: fracture_confident
  - scene: fracture_reiko
  - scene: fracture_uncertain
  - scene: chapter3_outro

scenes:
  evidence_table:
    actions:
      - bg: ryokan_hall
      - sticker:
          id: tape
          image: police_tape
          x: 0
          y: 30
          width: 120
          anchorX: left
          anchorY: top
          zIndex: 1
          enter:
            effect: fadeIn
            duration: 280
            easing: ease-out
      - music: mystery
      - say:
          text: "제3장 - 벽 너머의 목격자"
      - char:
          id: 코난
          position: center
          emotion: think
      - char:
          id: 코고로
          position: right
          emotion: angry
      - char:
          id: 란
          position: left
          emotion: worried
      - say:
          text: "임시 증거 테이블 위에는 젖은 찻잔, 문틀 사진, 외투가 올려져 있었다."
      - goto: clue_gate

  clue_gate:
    actions:
      - bg: tea_room
      - clearSticker:
          id: tape
          leave:
            effect: fadeOut
            duration: 220
      - music: tension
      - char:
          id: 코난
          position: center
          emotion: serious
      - input:
          prompt: "외투 소매에서 검출된 건 무엇이었지?"
          correct: "찻잎"
          errors:
            - "힌트: 다실 안에서만 묻을 수 있는 미세 가루야."
            - "차와 관련된 단어를 입력해봐."
            - "정답은 찻잎."
          saveAs: clue_word
          routes:
            - equals: "찻잎"
              set:
                found_key: true
              add:
                trust: 1
              goto: reenactment
            - equals: "혈흔"
              add:
                trust: -1
              goto: wrong_clue

  wrong_clue:
    actions:
      - effect: pulse
      - say:
          char: 코난
          text: "혈흔처럼 보였지만 성분이 달라. 다시 정리하자."
      - goto: clue_gate

  reenactment:
    actions:
      - bg: tea_room
      - music: mystery
      - char:
          id: 신이치
          position: right
          emotion: cold
      - char:
          id: 레이코
          position: left
          emotion: nervous
      - char:
          id: 코난
          position: center
          emotion: serious
      - say:
          text: "코난은 문 앞에서 사건 당시 동선을 다시 연기하게 했다."
      - sound: door
      - say:
          char: 코난
          text: "범인은 먼저 다실 안 소실에 숨는다. 피해자가 들어온 뒤 공격."
      - effect: darken
      - say:
          char: 코난
          text: "그리고 빗장 고리에 묶은 줄을 문틈으로 빼서, 바깥에서 당긴다."
      - effect: zoom
      - say:
          char: 코고로
          text: "그래서 안에서 잠긴 것처럼 보였군!"
      - goto: fracture

  fracture:
    actions:
      - bg: mountain_rain
      - music: tension
      - branch:
          cases:
            - when:
                all:
                  - var: found_key
                    op: eq
                    value: true
                  - var: trust
                    op: gte
                    value: 2
              goto: fracture_confident
            - when:
                var: suspect
                op: eq
                value: "레이코"
              goto: fracture_reiko
          default: fracture_uncertain

  fracture_confident:
    actions:
      - char:
          id: 코난
          position: center
          emotion: serious
      - char:
          id: 신이치
          position: right
          emotion: cold
      - say:
          char: 코난.serious
          text: "이제 남은 건 동기뿐이야. 트릭은 이미 밝혀졌어."
      - set:
          suspect: "신이치"
      - add:
          trust: 1
      - goto: chapter3_outro

  fracture_reiko:
    actions:
      - char:
          id: 레이코
          position: left
          emotion: nervous
      - char:
          id: 코난
          position: center
          emotion: think
      - say:
          char: 레이코.nervous
          text: "저는 협박받아서... 현장 정리만 도왔어요."
      - say:
          char: 코난
          text: "그 말이 사실이면 주범은 따로 있어."
      - add:
          trust: 0
      - goto: chapter3_outro

  fracture_uncertain:
    actions:
      - char:
          id: 하루오
          position: left
          emotion: scared
      - char:
          id: 코난
          position: center
          emotion: think
      - say:
          text: "증언은 남아 있는데 연결고리가 아직 약했다."
      - add:
          trust: -1
      - goto: chapter3_outro

  chapter3_outro:
    actions:
      - sound: thunder
      - effect: tilt
      - say:
          text: "비가 잦아드는 대신, 사람들의 표정은 더 어두워졌다."
      - goto: ./4.yaml
